DROP TABLE IF EXISTS CDW_SAPP_D_BRANCH_TEMP;
CREATE EXTERNAL TABLE CDW_SAPP_D_BRANCH_TEMP

(BRANCH_CODE int,
BRANCH_NAME varchar(25),
BRANCH_STREET varchar(30),
BRANCH_CITY varchar(30),
BRANCH_STATE varchar(30),
BRANCH_ZIP int,
BRANCH_PHONE varchar(15),
LAST_UPDATED Timestamp)

ROW FORMAT DELIMITED FIELDS
TERMINATED BY '\t' 
LINES TERMINATED BY '\n' 
location "/user/maria_dev/credit_card_system/branch";

DROP TABLE  IF EXISTS CDW_SAPP_D_BRANCH;
CREATE TABLE CDW_SAPP_D_BRANCH 

(BRANCH_CODE int,
BRANCH_NAME varchar(25),
BRANCH_STREET varchar(30),
BRANCH_CITY varchar(30),
BRANCH_ZIP int,
BRANCH_PHONE varchar(15),
LAST_UPDATED Timestamp)   
PARTITIONED BY (BRANCH_STATE varchar(30)) 

row format delimited fields 
TERMINATED BY '\t' 
lines terminated by '\n';


SET hive.exec.dynamic.partition = true;
SET hive.exec.dynamic.partition.mode = nonstrict;
INSERT OVERWRITE TABLE CDW_SAPP_D_BRANCH PARTITION (BRANCH_STATE)
SELECT 

BRANCH_CODE,
BRANCH_NAME,
BRANCH_STREET,
BRANCH_CITY,
BRANCH_ZIP,
BRANCH_PHONE,
LAST_UPDATED,
BRANCH_STATE

FROM CDW_SAPP_D_BRANCH_TEMP;


USE CDW_SAPP_D;

DROP TABLE IF EXISTS CDW_SAPP_D_CREDITCARD_TEMP;
CREATE TABLE CDW_SAPP_D_CREDITCARD_TEMP

(CUST_CC_NO varchar(16),
TIMEID VARCHAR(8),
CUST_SSN int,
BRANCH_CODE int,
TRANSACTION_TYPE VARCHAR(30),
TRANSACTION_VALUE FLOAT,
TRANSACTION_ID int)

row format delimited fields 
terminated by '\t'
lines terminated by '\n'
location "/user/maria_dev/credit_card_system/creditcard"; 

DROP TABLE IF EXISTS CDW_SAPP_D_CREDITCARD;
CREATE TABLE CDW_SAPP_D_CREDITCARD

(CUST_CC_NO varchar(16),
TIMEID VARCHAR(8),
CUST_SSN int,
TRANSACTION_TYPE VARCHAR(30),
TRANSACTION_VALUE FLOAT,
TRANSACTION_ID int)


PARTITIONED BY (BRANCH_CODE int) 

ROW FORMAT DELIMITED FIELDS
TERMINATED BY '\t' 
LINES TERMINATED BY '\n';

SET hive.exec.dynamic.partition = true;
SET hive.exec.dynamic.partition.mode = nonstrict;
INSERT OVERWRITE TABLE CDW_SAPP_D_CREDITCARD PARTITION(BRANCH_CODE)
SELECT 

CUST_CC_NO,
TIMEID,
CUST_SSN,
TRANSACTION_TYPE,
TRANSACTION_VALUE,
TRANSACTION_ID,
BRANCH_CODE

FROM CDW_SAPP_D_CREDITCARD_TEMP;

DROP TABLE IF EXISTS CDW_SAPP_D_CUSTOMER_TEMP;
CREATE EXTERNAL TABLE CDW_SAPP_D_CUSTOMER_TEMP

(CUST_SSN bigint,
CUST_F_NAME varchar(40),
CUST_M_NAME varchar(40),
CUST_L_NAME varchar(40),
CUST_CC_NO varchar(16),
CUST_STREET varchar(38),
CUST_CITY varchar(30),
CUST_STATE varchar(30),
CUST_COUNTRY varchar(30),
CUST_ZIP varchar(10),
CUST_PHONE varchar(20),
CUST_EMAIL varchar(40),
LAST_UPDATED Timestamp)

ROW FORMAT DELIMITED FIELDS
TERMINATED BY '\t' 
LINES TERMINATED BY '\n' 
location "/user/maria_dev/credit_card_system/customer";


DROP TABLE IF EXISTS CDW_SAPP_D_CUSTOMER;
CREATE TABLE CDW_SAPP_D_CUSTOMER 

(CUST_SSN bigint,
CUST_F_NAME varchar(40),
CUST_M_NAME varchar(40),
CUST_L_NAME varchar(40),
CUST_CC_NO varchar(16),
CUST_STREET varchar(38),
CUST_CITY varchar(30),
CUST_COUNTRY varchar(30),
CUST_ZIP varchar(10),
CUST_PHONE varchar(20),
CUST_EMAIL varchar(40),
LAST_UPDATED Timestamp)

PARTITIONED BY (CUST_STATE varchar(30)) 

ROW FORMAT DELIMITED FIELDS
TERMINATED BY '\t' 
LINES TERMINATED BY '\n';


SET hive.exec.dynamic.partition = true;
SET hive.exec.dynamic.partition.mode = nonstrict;
INSERT OVERWRITE TABLE CDW_SAPP_D_CUSTOMER PARTITION(CUST_STATE)
SELECT 

CUST_SSN,
CUST_F_NAME,
CUST_M_NAME,
CUST_L_NAME,
CUST_CC_NO,
CUST_STREET,
CUST_CITY,
CUST_COUNTRY,
CUST_ZIP,
CUST_PHONE,
CUST_EMAIL,
LAST_UPDATED,
CUST_STATE

FROM CDW_SAPP_D_CUSTOMER_TEMP;

DROP TABLE IF EXISTS CDW_SAPP_D_TIME_TEMP;
CREATE EXTERNAL TABLE CDW_SAPP_D_TIME_TEMP

(TIMEID varchar(10),
  DAY int,
  MONTH int,
QUARTER varchar(10),
    YEAR int)

row format delimited fields 
terminated by '\t'
lines terminated by '\n'
location "/user/maria_dev/credit_card_system/time"; 


CREATE TABLE CDW_SAPP_D_TIME

(TIMEID varchar(10),
  DAY int,
  MONTH int,
    YEAR int)


PARTITIONED BY (QUARTER varchar(10)) 

ROW FORMAT DELIMITED FIELDS
TERMINATED BY '\t' 
LINES TERMINATED BY '\n';

SET hive.exec.dynamic.partition = true;
SET hive.exec.dynamic.partition.mode = nonstrict;
INSERT OVERWRITE TABLE CDW_SAPP_D_TIME PARTITION(QUARTER)

SELECT 

 TIMEID,
  DAY,
   MONTH,
    YEAR,
      QUARTER

FROM CDW_SAPP_D_TIME_TEMP;